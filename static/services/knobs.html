<!DOCTYPE html>
<script type=module>

import Observers from '/js/Observers.js';

window.top.ServiceManager.register('knobs', {
  state: {},
  observers: new Observers(),
  observe(key, win, cb, def) {
    this.observers.add(key, win, cb);
    cb(this.get(key, def));
  },
  get(key, def) {
    return (key in this.state) ? this.state[key] : def;
  },
  set(key, val) {
    const oldValue = this.state[key];
    this.state[key] = val;
    this.observers.fire(key, val, oldValue);
  },
});

</script>
